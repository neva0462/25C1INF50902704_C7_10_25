<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Game Flappy Bird - N√¢ng Cao</title>
    <!-- Icon c·ªßa trang web (hi·ªÉn th·ªã tr√™n tab tr√¨nh duy·ªát) -->
    <link
      rel="icon"
      type="image/png"
      href="https://upload.wikimedia.org/wikipedia/commons/7/71/Logo_UEH_xanh.png"
    />
    <style>
      /* Reset CSS: X√≥a m·ªçi margin, padding m·∫∑c ƒë·ªãnh c·ªßa tr√¨nh duy·ªát
        ƒë·ªÉ ƒë·∫£m b·∫£o giao di·ªán nh·∫•t qu√°n tr√™n m·ªçi tr√¨nh duy·ªát.
      */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      /* Thi·∫øt l·∫≠p cho to√†n b·ªô trang */
      body {
        height: 100vh; /* Cao 100% chi·ªÅu cao c·ªßa m√†n h√¨nh */
        width: 100vw; /* R·ªông 100% chi·ªÅu r·ªông c·ªßa m√†n h√¨nh */
        display: flex; /* S·ª≠ d·ª•ng Flexbox ƒë·ªÉ cƒÉn ch·ªânh n·ªôi dung */
        justify-content: center; /* CƒÉn gi·ªØa n·ªôi dung theo chi·ªÅu ngang */
        align-items: center; /* CƒÉn gi·ªØa n·ªôi dung theo chi·ªÅu d·ªçc */
        /* [THAY ƒê·ªîI] N·ªÅn x√°m xanh nh·∫°t tinh t·∫ø h∆°n */
        background-color: #e2ebf0;
        font-family: "Arial", sans-serif; /* Font ch·ªØ m·∫∑c ƒë·ªãnh */
      }

      /* Khung ch·ª©a tr√≤ ch∆°i */
      #container {
        position: relative; /* ƒê·ªÉ c√°c ph·∫ßn t·ª≠ con c√≥ th·ªÉ ƒë·ªãnh v·ªã tuy·ªát ƒë·ªëi (position: absolute) b√™n trong n√≥ */
        height: 600px; /* Chi·ªÅu cao c·ªë ƒë·ªãnh c·ªßa game */
        width: 400px; /* Chi·ªÅu r·ªông c·ªë ƒë·ªãnh c·ªßa game */
        border: 4px solid #0fc9fc; /* ƒê∆∞·ªùng vi·ªÅn cho khung game */
        /* N·ªÅn tr·ªùi v√† m·∫∑t ƒë·∫•t */
        background: linear-gradient(
          to bottom,
          #87ceeb 0%,
          #87ceeb 75%,
          /* 75% ·ªü tr√™n l√† tr·ªùi xanh */ #e69cf1 75%,
          #ca80c5 100% /* 25% ·ªü d∆∞·ªõi l√† ƒë·∫•t m√†u cam */
        );
        overflow: hidden; /* ·∫®n m·ªçi th·ª© v∆∞·ª£t ra ngo√†i khung game (quan tr·ªçng ƒë·ªÉ ·ªëng kh√≥i bi·∫øn m·∫•t) */
        box-shadow: 0 15px 50px rgba(0, 0, 0, 0.4); /* Hi·ªáu ·ª©ng ƒë·ªï b√≥ng */
        border-radius: 10px; /* Bo g√≥c */
      }

      /* ---- BIRD ---- */
      #bird {
        position: absolute; /* ƒê·ªãnh v·ªã tuy·ªát ƒë·ªëi so v·ªõi #container */
        height: 45px;
        width: 45px;
        top: 20%; /* V·ªã tr√≠ ban ƒë·∫ßu (theo chi·ªÅu d·ªçc) */
        left: 15%; /* V·ªã tr√≠ ban ƒë·∫ßu (theo chi·ªÅu ngang) */
        transition: transform 0.1s; /* Hi·ªáu ·ª©ng xoay m∆∞·ª£t m√† */
        filter: drop-shadow(
          2px 2px 3px rgba(0, 0, 0, 0.3)
        ); /* ƒê·ªï b√≥ng cho chim */
        z-index: 20; /* ƒê·∫£m b·∫£o chim n·∫±m tr√™n ·ªëng kh√≥i */
      }

      /* D√πng pseudo-element ::before ƒë·ªÉ hi·ªÉn th·ªã emoji */
      #bird::before {
        content: "ü¶¢"; /* Con thi√™n nga */
        font-size: 45px;
        position: absolute;
        top: -5px;
        left: -5px;
        display: inline-block; /* C·∫ßn c√≥ ƒë·ªÉ transform ho·∫°t ƒë·ªông */
        transform: scaleX(-1); /* L·∫≠t ng∆∞·ª£c con chim sang ph·∫£i */
      }

      /* ---- ·ªêNG KH√ìI (POLE) ---- */
      .pole {
        position: absolute;
        width: 65px;
        right: -70px; /* V·ªã tr√≠ ban ƒë·∫ßu, n·∫±m ngo√†i m√†n h√¨nh b√™n ph·∫£i */
        /* D√πng CSS Gradient ƒë·ªÉ t·∫°o h√¨nh ·∫£nh ·ªëng kh√≥i */
        background: linear-gradient(
          to right,
          #cccfd2 0%,
          #a7abae 50%,
          #ecedef 100%
        );
        border: 3px solid #1a252f;
        box-shadow: inset -3px 0 8px rgba(0, 0, 0, 0.4),
          3px 0 10px rgba(0, 0, 0, 0.3);
        z-index: 10; /* N·∫±m d∆∞·ªõi con chim */
      }

      /* D√πng ::after ƒë·ªÉ t·∫°o hi·ªáu ·ª©ng kh√≥i */
      .pole::after {
        content: "";
        position: absolute;
        width: 80px;
        height: 20px;
        background: radial-gradient(
          circle,
          rgba(200, 200, 200, 0.6) 0%,
          transparent 70%
        );
        left: -10px;
        animation: smoke 2s infinite; /* G·ªçi animation 'smoke' */
      }

      /* ·ªêng kh√≥i tr√™n */
      #pole_1 {
        top: 0; /* N·∫±m ·ªü tr√™n c√πng */
        border-top: none; /* X√≥a vi·ªÅn tr√™n */
      }

      #pole_1::after {
        bottom: -15px; /* Hi·ªáu ·ª©ng kh√≥i ·ªü d∆∞·ªõi ·ªëng */
      }

      /* ·ªêng kh√≥i d∆∞·ªõi */
      #pole_2 {
        bottom: 0; /* N·∫±m ·ªü d∆∞·ªõi c√πng */
        border-bottom: none; /* X√≥a vi·ªÅn d∆∞·ªõi */
      }

      #pole_2::after {
        top: -15px; /* Hi·ªáu ·ª©ng kh√≥i ·ªü tr√™n ·ªëng */
      }

      /* Animation cho kh√≥i */
      @keyframes smoke {
        0% {
          opacity: 0.6;
          transform: translateX(0) scale(1);
        }
        50% {
          opacity: 0.3;
          transform: translateX(-10px) scale(1.2);
        }
        100% {
          opacity: 0;
          transform: translateX(-20px) scale(1.4);
        }
      }

      /* ---- V·∫¨T PH·∫®M (ITEM) ---- */
      #life_item {
        position: absolute;
        width: 30px;
        height: 30px;
        right: -30px; /* B·∫Øt ƒë·∫ßu ngo√†i m√†n h√¨nh */
        top: 50%; /* B·∫Øt ƒë·∫ßu ·ªü gi·ªØa */
        z-index: 15; /* N·∫±m tr√™n ·ªëng kh√≥i, d∆∞·ªõi con chim */
        display: none; /* Ban ƒë·∫ßu ·∫©n ƒëi */
      }
      /* D√πng ::before ƒë·ªÉ hi·ªÉn th·ªã emoji tr√°i tim */
      #life_item::before {
        content: "‚ù§Ô∏è";
        font-size: 30px;
        position: absolute;
        filter: drop-shadow(2px 2px 2px rgba(0, 0, 0, 0.5));
        animation: bounce-heart 1s infinite;
      }
      /* Animation cho tr√°i tim n·∫£y nh·∫π */
      @keyframes bounce-heart {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-10px);
        }
      }

      /* ---- GIAO DI·ªÜN NG∆Ø·ªúI D√ôNG (UI) ---- */

      /* Hi·ªÉn th·ªã Level */
      #level_display {
        position: absolute;
        top: 15px;
        left: 15px; /* G√≥c tr√™n b√™n tr√°i */
        font-size: 20px;
        font-weight: bold;
        color: #fff;
        background: rgba(0, 0, 0, 0.6);
        padding: 10px 15px;
        border-radius: 10px;
        z-index: 100; /* N·∫±m tr√™n c√°c ph·∫ßn t·ª≠ kh√°c */
        text-shadow: 2px 2px 4px #000;
        border: 2px solid #ffd700;
      }

      /* Hi·ªÉn th·ªã M·∫°ng (Lives) */
      #lives_display {
        position: absolute;
        top: 70px; /* [THAY ƒê·ªîI] D·ªùi xu·ªëng th√™m 5px */
        left: 15px;
        font-size: 20px;
        font-weight: bold;
        color: #fff;
        background: rgba(255, 0, 0, 0.6);
        padding: 5px 15px;
        border-radius: 10px;
        z-index: 100;
      }

      /* Hi·ªÉn th·ªã ƒëi·ªÉm s·ªë */
      #score {
        font-size: 40px;
        position: absolute;
        top: 15px;
        right: 15px; /* G√≥c tr√™n b√™n ph·∫£i */
        color: #fff;
        font-weight: bold;
        text-shadow: 3px 3px 0 #000, -1px -1px 0 #000, 1px -1px 0 #000,
          -1px 1px 0 #000;
        z-index: 100;
        background: rgba(0, 0, 0, 0.4);
        padding: 10px 20px;
        border-radius: 10px;
      }

      /* Hi·ªÉn th·ªã ƒëi·ªÉm cao */
      #highscore_display {
        position: absolute;
        top: 85px; /* [THAY ƒê·ªîI] D·ªùi xu·ªëng th√™m 10px */
        right: 15px;
        font-size: 16px;
        color: #ffd700;
        background: rgba(0, 0, 0, 0.5);
        padding: 5px 15px;
        border-radius: 8px;
        z-index: 100;
        text-shadow: 1px 1px 2px #000;
      }

      /* N√∫t Ch∆°i L·∫°i */
      #restart_btn {
        position: absolute;
        top: 60%;
        left: 50%;
        transform: translate(-50%, -50%);
        padding: 15px 40px;
        /* [THAY ƒê·ªîI] ƒê·ªïi m√†u n√∫t sang xanh l√° */
        background: #4caf50;
        color: #fff;
        font-size: 24px;
        font-weight: bold;
        border: 3px solid #fff;
        border-radius: 15px;
        cursor: pointer;
        display: none;
        z-index: 100;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        transition: all 0.3s;
      }

      /* Hi·ªáu ·ª©ng khi r√™ chu·ªôt v√†o n√∫t ch∆°i l·∫°i */
      #restart_btn:hover {
        transform: translate(-50%, -50%) scale(1.1);
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.5);
        background: #45a049; /* [THAY ƒê·ªîI] M√†u xanh ƒë·∫≠m h∆°n */
      }

      /* N√∫t B·∫Øt ƒê·∫ßu Ch∆°i (m√†n h√¨nh ch·ªù) */
      #play_btn {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        position: absolute;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7); /* L·ªõp n·ªÅn m·ªù */
        border: 0;
        font-size: 28px;
        font-weight: bold;
        color: #fff;
        cursor: pointer;
        z-index: 50;
        text-shadow: 2px 2px 4px #000;
      }

      #play_btn:hover {
        background: rgba(0, 0, 0, 0.8); /* ƒê·∫≠m h∆°n khi r√™ chu·ªôt */
      }

      /* H∆∞·ªõng d·∫´n trong n√∫t Play */
      .instruction {
        margin-top: 20px;
        font-size: 16px;
        opacity: 0.9;
        padding: 10px 20px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 10px;
      }

      /* Th√¥ng b√°o GAME OVER v√† CHI·∫æN TH·∫ÆNG */
      #game_over_msg,
      #victory_msg {
        position: absolute;
        top: 30%; /* N·∫±m ·ªü 30% t·ª´ tr√™n xu·ªëng */
        left: 50%;
        transform: translateX(-50%); /* CƒÉn gi·ªØa theo chi·ªÅu ngang */
        font-size: 48px;
        font-weight: bold;
        color: #fff;
        text-shadow: 4px 4px 0 #000;
        display: none; /* Ban ƒë·∫ßu ·∫©n ƒëi */
        z-index: 99;
        text-align: center;
      }

      #victory_msg {
        color: #ffd700; /* M√†u v√†ng cho chi·∫øn th·∫Øng */
        font-size: 42px;
      }

      .victory-icon {
        font-size: 80px;
        display: block;
        margin-bottom: 10px;
        animation: bounce 0.8s infinite; /* G·ªçi animation 'bounce' */
      }

      /* Animation cho icon chi·∫øn th·∫Øng */
      @keyframes bounce {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-20px); /* N·∫£y l√™n */
        }
      }

      /* Hi·ªÉn th·ªã t·ªëc ƒë·ªô (theo level) */
      #speed_indicator {
        position: absolute;
        bottom: 15px;
        left: 15px; /* G√≥c d∆∞·ªõi b√™n tr√°i */
        font-size: 14px;
        color: #fff;
        background: rgba(255, 0, 0, 0.6);
        padding: 8px 15px;
        border-radius: 8px;
        z-index: 10;
        font-weight: bold;
      }

      /* Tr·ª£ gi√∫p ƒëi·ªÅu khi·ªÉn */
      #controls_help {
        position: absolute;
        bottom: 15px;
        right: 15px; /* G√≥c d∆∞·ªõi b√™n ph·∫£i */
        font-size: 12px;
        color: #fff;
        background: rgba(0, 0, 0, 0.6);
        padding: 8px 12px;
        border-radius: 8px;
        z-index: 10;
        display: none; /* ·∫®n ƒëi, ch·ªâ hi·ªán khi ch∆°i */
      }

      /* L·ªõp 'show' (th√™m b·∫±ng JS) ƒë·ªÉ hi·ªán tr·ª£ gi√∫p */
      #controls_help.show {
        display: block;
      }
    </style>
  </head>
  <body>
    <!-- C√°c th·∫ª Audio ƒë·ªÉ ph√°t √¢m thanh.
         'preload="auto"' gi√∫p tr√¨nh duy·ªát t·∫£i file √¢m thanh s·∫µn s√†ng.
         C√°c file n√†y ƒë∆∞·ª£c host online.
    -->
    <audio
      id="audio_flap"
      src="https://actions.google.com/sounds/v1/impacts/cloth_flaps_in_wind.ogg"
      preload="auto"
    ></audio>
    <audio
      id="audio_score"
      src="https://actions.google.com/sounds/v1/cartoon/magic_chime.ogg"
      preload="auto"
    ></audio>
    <audio
      id="audio_hit"
      src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"
      preload="auto"
    ></audio>
    <!-- Th√™m √¢m thanh v·∫≠t ph·∫©m -->
    <audio
      id="audio_item"
      src="https://actions.google.com/sounds/v1/achievements/achievement_trumpet.ogg"
      preload="auto"
    ></audio>

    <!-- Nh·∫°c n·ªÅn (BGM) cho tr√≤ ch∆°i, 'loop' ƒë·ªÉ l·∫∑p l·∫°i v√¥ t·∫≠n -->
    <audio
      id="audio_bgm"
      src="https://actions.google.com/sounds/v1/backtracks/quiet_time.ogg"
      preload="auto"
      loop
    ></audio>

    <!-- ƒê√¢y l√† khung ch·ª©a to√†n b·ªô tr√≤ ch∆°i, ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a trong CSS -->
    <div id="container">
      <!-- Ph·∫ßn t·ª≠ con chim -->
      <div id="bird"></div>
      <!-- Hai ·ªëng kh√≥i -->
      <div id="pole_1" class="pole"></div>
      <div id="pole_2" class="pole"></div>

      <!-- Th√™m v·∫≠t ph·∫©m v√†o game -->
      <div id="life_item"></div>

      <!-- N√∫t b·∫Øt ƒë·∫ßu game (m√†n h√¨nh ch·ªù) -->
      <button id="play_btn">
        üéÆ B·∫ÆT ƒê·∫¶U CH∆†I
        <!-- C·∫≠p nh·∫≠t h∆∞·ªõng d·∫´n ƒëi·ªÅu khi·ªÉn cho ƒë√∫ng -->
        <span class="instruction">Nh·∫•n 'SPACE' ho·∫∑c '‚¨áÔ∏è' ƒë·ªÉ bay l√™n</span>
      </button>

      <!-- C√°c ph·∫ßn t·ª≠ giao di·ªán (UI) -->
      <div id="level_display">Level: 1</div>
      <!-- Th√™m hi·ªÉn th·ªã m·∫°ng -->
      <div id="lives_display">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
      <span id="score">0</span>
      <div id="highscore_display">High: 0</div>
      <div id="speed_indicator">Speed: Normal</div>
      <div id="controls_help">SPACE / ‚¨áÔ∏è</div>
      <!-- H∆∞·ªõng d·∫´n khi ch∆°i -->
      <div id="game_over_msg">GAME OVER!</div>
      <!-- Th√¥ng b√°o thua -->
      <div id="victory_msg">
        <!-- Th√¥ng b√°o th·∫Øng -->
        <span class="victory-icon">üèÜ</span>
        CHI·∫æN TH·∫ÆNG!
      </div>

      <!-- N√∫t ch∆°i l·∫°i (hi·ªán khi thua ho·∫∑c th·∫Øng) -->
      <button id="restart_btn">üîÑ CH∆†I L·∫†I</button>
    </div>

    <!-- T·∫£i th∆∞ vi·ªán jQuery t·ª´ CDN -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
      // $(function () { ... }) l√† c√∫ ph√°p c·ªßa jQuery,
      // ƒë·∫£m b·∫£o m√£ b√™n trong ch·ªâ ch·∫°y khi trang web ƒë√£ t·∫£i xong.
      $(function () {
        // --- 1. L·∫§Y V√Ä L∆ØU TR·ªÆ C√ÅC BI·∫æN (CACHE) ---
        var container = $("#container");
        var bird = $("#bird");
        var pole = $(".pole");
        var pole_1 = $("#pole_1");
        var pole_2 = $("#pole_2");
        var score_display = $("#score");
        var level_display = $("#level_display");
        var restart_btn = $("#restart_btn");
        var play_btn = $("#play_btn");
        var game_over_msg = $("#game_over_msg");
        var victory_msg = $("#victory_msg");
        var highscore_display = $("#highscore_display");
        var speed_indicator = $("#speed_indicator");
        var controls_help = $("#controls_help");

        // L·∫•y bi·∫øn UI v√† √¢m thanh m·ªõi
        var lives_display = $("#lives_display");
        var life_item = $("#life_item");
        var audio_item = $("#audio_item")[0];

        // L·∫•y c√°c bi·∫øn √¢m thanh
        var audio_flap = $("#audio_flap")[0];
        var audio_score = $("#audio_score")[0];
        var audio_hit = $("#audio_hit")[0];
        var audio_bgm = $("#audio_bgm")[0];
        audio_bgm.volume = 0.3; // Gi·∫£m √¢m l∆∞·ª£ng nh·∫°c n·ªÅn xu·ªëng 30%
        audio_item.volume = 0.5;

        // --- 2. C√ÅC BI·∫æN THI·∫æT L·∫¨P K√çCH TH∆Ø·ªöC ---
        var container_width = parseInt(container.width());
        var container_height = parseInt(container.height());
        var pole_initial_position = parseInt(pole.css("right"));
        var pole_initial_height = 200;
        var bird_left = parseInt(bird.css("left"));
        var bird_height = parseInt(bird.height());
        var base_speed = 3;

        // --- 3. C√ÅC BI·∫æN TR·∫†NG TH√ÅI GAME ---
        var score_updated = false;
        var game_over = false;
        var the_game;
        var current_score = 0;
        var current_level = 1;
        var game_interval = 40;
        var high_score = localStorage.getItem("flappybird_highscore") || 0;

        // Th√™m bi·∫øn M·∫°ng (Lives)
        var current_lives = 3;
        var is_hit = false; // Bi·∫øn c·ªù, ƒë√°nh d·∫•u chim v·ª´a b·ªã va ch·∫°m

        // Bi·∫øn tr·∫°ng th√°i v·∫≠t ph·∫©m
        var item_active = false; // V·∫≠t ph·∫©m ƒëang c√≥ tr√™n m√†n h√¨nh
        var item_speed = 2; // T·ªëc ƒë·ªô v·∫≠t ph·∫©m

        // --- 4. C√ÅC BI·∫æN V·∫¨T L√ù ---
        var bird_velocity = 0;
        var gravity = 0.5;
        var jump_strength = -8;

        // --- 5. C·∫§U H√åNH LEVEL ---
        var level_config = {
          1: { interval: 40, speed: 3, threshold: 0, name: "Normal" },
          2: { interval: 30, speed: 4, threshold: 5, name: "Fast" },
          3: { interval: 25, speed: 5, threshold: 20, name: "Faster" },
          4: { interval: 20, speed: 6, threshold: 40, name: "Extreme" },
        };

        // --- 6. KH·ªûI T·∫†O GAME L·∫¶N ƒê·∫¶U ---
        highscore_display.text("High: " + high_score);
        pole_1.css("height", pole_initial_height);
        pole_2.css("height", pole_initial_height);
        updateLivesDisplay(); // C·∫≠p nh·∫≠t hi·ªÉn th·ªã m·∫°ng

        // --- 7. H√ÄM C·∫¨P NH·∫¨T LEVEL ---
        function updateLevel(score) {
          var new_level = 1;

          if (score >= 40) new_level = 4;
          else if (score >= 20) new_level = 3;
          else if (score >= 5) new_level = 2;
          else new_level = 1;

          if (new_level !== current_level) {
            current_level = new_level;
            level_display.text("Level: " + current_level);

            game_interval = level_config[current_level].interval;
            base_speed = level_config[current_level].speed;
            speed_indicator.text("Speed: " + level_config[current_level].name);

            clearInterval(the_game);
            if (!game_over) {
              playGame();
            }
          }
        }

        // --- 8. V√íNG L·∫∂P GAME CH√çNH (GAME LOOP) ---
        function playGame() {
          the_game = setInterval(function () {
            if (game_over) {
              return;
            }

            // N·∫øu chim ƒëang b·ªã va ch·∫°m, b·ªè qua frame n√†y
            if (is_hit) {
              return;
            }

            // Ki·ªÉm tra th·∫Øng
            if (current_score >= 50) {
              victory();
              return;
            }

            // Ki·ªÉm tra va ch·∫°m ·ªëng ho·∫∑c tr·∫ßn/s√†n
            if (
              collision(bird, pole_1) ||
              collision(bird, pole_2) ||
              parseInt(bird.css("top")) <= 0 ||
              parseInt(bird.css("top")) > container_height - bird_height
            ) {
              handleHit(); // X·ª≠ l√Ω va ch·∫°m (tr·ª´ m·∫°ng)
            } else {
              // --- X·ª≠ l√Ω ·ªêng kh√≥i (Poles) ---
              var pole_current_position = parseInt(pole.css("right"));

              // T√≠nh ƒëi·ªÉm
              if (pole_current_position > container_width - bird_left) {
                if (score_updated === false) {
                  current_score++;
                  score_display.text(current_score);
                  score_updated = true;

                  audio_score.currentTime = 0;
                  audio_score.play();

                  updateLevel(current_score);
                }
              }

              // Reset ·ªëng kh√≥i
              if (pole_current_position > container_width) {
                var new_height = parseInt(Math.random() * 150);
                pole_1.css("height", pole_initial_height + new_height);
                pole_2.css("height", pole_initial_height - new_height);

                score_updated = false;
                pole_current_position = pole_initial_position;

                // Logic t·∫°o v·∫≠t ph·∫©m
                // Ch·ªâ t·∫°o khi (level > 1) V√Ä (ƒëang kh√¥ng c√≥ v·∫≠t ph·∫©m)
                // V√Ä (25% may m·∫Øn)
                // [THAY ƒê·ªîI] Th√™m ƒëi·ªÅu ki·ªán: ch·ªâ t·∫°o khi m·∫°ng < 6
                if (
                  current_level >= 2 &&
                  !item_active &&
                  Math.random() < 0.25 &&
                  current_lives < 6
                ) {
                  spawnLifeItem();
                }
              }

              // Di chuy·ªÉn ·ªëng
              pole.css("right", pole_current_position + base_speed);

              // --- X·ª≠ l√Ω V·∫≠t ph·∫©m (Item) ---
              if (item_active) {
                // Ki·ªÉm tra ƒÉn v·∫≠t ph·∫©m
                if (collision(bird, life_item)) {
                  gainLife();
                } else {
                  // Di chuy·ªÉn v·∫≠t ph·∫©m
                  var item_current_position = parseInt(life_item.css("right"));
                  if (item_current_position > container_width + 30) {
                    // V·∫≠t ph·∫©m ra kh·ªèi m√†n h√¨nh
                    item_active = false;
                    life_item.hide();
                  } else {
                    life_item.css("right", item_current_position + item_speed);
                  }
                }
              }

              // --- X·ª≠ l√Ω Chim (Bird) ---
              bird_velocity += gravity;
              bird.css("top", parseInt(bird.css("top")) + bird_velocity);

              if (bird_velocity < 0) {
                bird.css("transform", "rotate(-20deg)");
              } else {
                bird.css("transform", "rotate(30deg)");
              }
            }
          }, game_interval);
        }

        // --- 9. X·ª¨ L√ù S·ª∞ KI·ªÜN (EVENTS) ---

        // Nh·∫•n ph√≠m
        $(document).keydown(function (e) {
          if (!game_over && !play_btn.is(":visible") && !is_hit) {
            if (e.keyCode === 32 || e.keyCode === 40) {
              e.preventDefault();
              bird_velocity = jump_strength;
              audio_flap.currentTime = 0;
              audio_flap.play();
            }
          }
        });

        // Nh·∫•n n√∫t "B·∫ÆT ƒê·∫¶U CH∆†I"
        play_btn.click(function () {
          audio_bgm.play();
          playGame();
          $(this).hide();
          controls_help.addClass("show");
        });

        // --- 10. C√ÅC H√ÄM CH·ª®C NƒÇNG GAME ---

        // H√†m x·ª≠ l√Ω khi va ch·∫°m
        function handleHit() {
          is_hit = true; // ƒê√°nh d·∫•u l√† ƒëang b·ªã va ch·∫°m
          current_lives--; // Tr·ª´ 1 m·∫°ng
          updateLivesDisplay(); // C·∫≠p nh·∫≠t hi·ªÉn th·ªã

          audio_hit.currentTime = 0;
          audio_hit.play();

          // Ki·ªÉm tra xem h·∫øt m·∫°ng ch∆∞a
          if (current_lives <= 0) {
            stop_the_game(); // H·∫øt m·∫°ng -> Game Over
            return;
          }

          // N·∫øu c√≤n m·∫°ng:
          // 1. T·∫°o hi·ªáu ·ª©ng nh·∫•p nh√°y (blink)
          bird.fadeOut(100).fadeIn(100).fadeOut(100).fadeIn(100);

          // 2. Reset v·ªã tr√≠ chim v√† ·ªëng kh√≥i sau 0.5s
          setTimeout(function () {
            bird.css("top", "20%"); // ƒê∆∞a chim v·ªÅ v·ªã tr√≠ gi·ªØa
            bird_velocity = 0; // Reset v·∫≠n t·ªëc
            pole.css("right", pole_initial_position); // ƒê·∫©y ·ªëng kh√≥i ra xa
            score_updated = false; // Reset c·ªù t√≠nh ƒëi·ªÉm
            is_hit = false; // B·ªè ƒë√°nh d·∫•u va ch·∫°m
          }, 500);
        }

        // H√†m t·∫°o v·∫≠t ph·∫©m
        function spawnLifeItem() {
          item_active = true;
          // ƒê·∫∑t v·ªã tr√≠ Y (chi·ªÅu cao) ng·∫´u nhi√™n
          var item_top =
            Math.random() * (container_height * 0.6) + container_height * 0.2; // (t·ª´ 20% ƒë·∫øn 80% chi·ªÅu cao)
          life_item.css("top", item_top + "px");
          life_item.css("right", "-30px"); // ƒê·∫∑t l·∫°i v·ªã tr√≠ X
          life_item.show();
        }

        // H√†m ƒÉn v·∫≠t ph·∫©m
        function gainLife() {
          // [THAY ƒê·ªîI] Ch·ªâ c·ªông m·∫°ng n·∫øu ƒëang d∆∞·ªõi 6
          if (current_lives < 6) {
            current_lives++; // C·ªông 1 m·∫°ng
            updateLivesDisplay(); // C·∫≠p nh·∫≠t hi·ªÉn th·ªã
            audio_item.currentTime = 0;
            audio_item.play();
          }

          // ·∫®n v·∫≠t ph·∫©m ƒëi (lu√¥n lu√¥n, ngay c·∫£ khi ƒë√£ 6 m·∫°ng)
          item_active = false;
          life_item.hide();
        }

        // H√†m c·∫≠p nh·∫≠t hi·ªÉn th·ªã m·∫°ng
        function updateLivesDisplay() {
          var hearts = "";
          for (var i = 0; i < current_lives; i++) {
            hearts += "‚ù§Ô∏è";
          }
          lives_display.text(hearts);
        }

        // H√†m ƒë∆∞·ª£c g·ªçi khi THUA (h·∫øt m·∫°ng)
        function stop_the_game() {
          audio_bgm.pause();
          audio_bgm.currentTime = 0;
          game_over = true;
          clearInterval(the_game);

          if (current_score > high_score) {
            high_score = current_score;
            localStorage.setItem("flappybird_highscore", high_score);
            highscore_display
              .text("High: " + high_score)
              .css("color", "#FFD700");
          }

          game_over_msg.fadeIn();
          restart_btn.fadeIn();
        }

        // H√†m ƒë∆∞·ª£c g·ªçi khi TH·∫ÆNG (ƒë·∫°t 50 ƒëi·ªÉm)
        function victory() {
          audio_bgm.pause();
          audio_bgm.currentTime = 0;

          game_over = true;
          clearInterval(the_game);

          // Ph√°t √¢m thanh chi·∫øn th·∫Øng (d√πng t·∫°m √¢m thanh v·∫≠t ph·∫©m)
          audio_item.currentTime = 0;
          audio_item.play();

          // C·∫≠p nh·∫≠t ƒëi·ªÉm cao (n·∫øu c·∫ßn)
          if (current_score > high_score) {
            high_score = current_score;
            localStorage.setItem("flappybird_highscore", high_score);
            highscore_display
              .text("High: " + high_score)
              .css("color", "#FFD700");
          }

          victory_msg.fadeIn();
          restart_btn.fadeIn();
        }

        // S·ª± ki·ªán nh·∫•n n√∫t "CH∆†I L·∫†I"
        restart_btn.click(function () {
          location.reload(); // T·∫£i l·∫°i trang web (c√°ch ƒë∆°n gi·∫£n nh·∫•t ƒë·ªÉ reset game)
        });

        // --- 11. H√ÄM KI·ªÇM TRA VA CH·∫†M (COLLISION) ---
        function collision($div1, $div2) {
          // L·∫•y t·ªça ƒë·ªô v√† k√≠ch th∆∞·ªõc c·ªßa div 1
          var x1 = $div1.offset().left;
          var y1 = $div1.offset().top;
          var h1 = $div1.outerHeight(true);
          var w1 = $div1.outerWidth(true);
          var b1 = y1 + h1; // T·ªça ƒë·ªô ƒë√°y
          var r1 = x1 + w1; // T·ªça ƒë·ªô ph·∫£i

          // L·∫•y t·ªça ƒë·ªô v√† k√≠ch th∆∞·ªõc c·ªßa div 2
          var x2 = $div2.offset().left;
          var y2 = $div2.offset().top;
          var h2 = $div2.outerHeight(true);
          var w2 = $div2.outerWidth(true);
          var b2 = y2 + h2; // T·ªça ƒë·ªô ƒë√°y
          var r2 = x2 + w2; // T·ªça ƒë·ªô ph·∫£i

          if (b1 < y2 || y1 > b2 || r1 < x2 || x1 > r2) {
            return false;
          } else {
            return true;
          }
        }
      });
    </script>
  </body>
</html>
